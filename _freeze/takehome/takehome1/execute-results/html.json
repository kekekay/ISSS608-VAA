{
  "hash": "8454ea84aee7bce1f158fd4e177aea8b",
  "result": {
    "markdown": "---\ntitle: \"Take-home Exercise 1:Singapore Private Residential Market\"\nauthor: \"Ke Ke\"\ndate: \"18 Apr 2024\"\ndate-modified: \"last-modified\"\nformat:\n  html:\n    code-fold: true\n    code-tools: true\nexecute:\n  warning: false\n  freeze: true\n---\n\n\n![Take Home Ex1 : Singapore private residential market](images/title.jpg){fig-align=\"left\"}\n\n# Task\n\nIn this Take Home Exercise, a few compelling and insightful data visualizations for the Singapore private residential market and its sub-markets for the first quarter of 2024 are created using Quarto.\n\n\n```{mermaid}\nflowchart LR\n  A[Data Preparation] --> B[Data Summary]\n  B --> C{Data Cleaning}\n  C --> D[Market Overview Visualization 1: Trend of Average Unit Prices by Planning Region]\n  C --> E[Market Overview Visualization 2: Popularity by Type of Sale]\n```\n\n\n# Data Preparation\n\nData Source: [private residential property transaction data from 1st January 2023 to 31st March 2024](https://www.ura.gov.sg/reis/index)\n\nLoaded necessary libraries and set the working directory to source transaction data. Aggregated CSV files, collating rows to form a complete dataset. Performed initial data summary, extracting transaction count, date range, unique property types, and regions. Cleaned data, replacing empty values with NAs and converting numeric fields for insightful analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ggplot2,lubridate,ggrepel, patchwork, \n               ggthemes, hrbrthemes,\n               tidyverse)\n\nsetwd(\"C:/kekekay/ISSS608-VAA/takehome/data\")\nfull_data <-  list.files(\n                    pattern = \"*.csv\",\n                    full.names=T) %>%\n                    lapply(read_csv) %>%\n                    bind_rows()\n```\n:::\n\n\n# Data Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data summary\ntotal_transactions <- nrow(full_data)\ndate_range <- range(full_data$`Sale Date`, na.rm = TRUE)\nproperty_types <- unique(full_data$`Property Type`)\ntotal_property_types <- length(property_types)\nregion<- unique(full_data$`Planning Region`)\narea<- unique(full_data$`Planning Area`)\n```\n:::\n\n\nTotal Transactions:26806\n\nDate Range is from 01 Apr 2023 to 31 Oct 2023\n\nTotal Unique Property Types: 6\n\nList of Property Types: Condominium, Executive Condominium, Terrace House, Semi-Detached House, Apartment, Detached House\n\n![Five regions and planning area boundaries of Singapore were used in this study. Data source: URA (2021).](images/Five-regions-and-planning-area-boundaries-of-Singapore-were-used-in-this-study-Data.png)\n\nPlanning Region: Central Region, East Region, North Region, North East Region, West Region\n\nPlanning Area: Bukit Merah, Bedok, Yishun, Sengkang, Hougang, Bukit Timah, Marine Parade, Clementi, Woodlands, Serangoon, Tanglin, Tampines, Kallang, Rochor, Novena, Punggol, Sembawang, Downtown Core, Bishan, Jurong West, Pasir Ris, Queenstown, Bukit Panjang, Bukit Batok, Museum, Newton, Southern Islands, Toa Payoh, Choa Chu Kang, Geylang, River Valley, Orchard, Singapore River, Outram, Tengah, Ang Mo Kio, Jurong East, Mandai, Sungei Kadut, Changi, Paya Lebar\n\n# Data Cleaning\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncleaned_data <- full_data %>%\n  mutate(across(c(`Nett Price($)`, `Area (SQM)`, `Unit Price ($ PSM)`), ~replace(., . == \"\" | . == \"-\", NA))) %>%\n  mutate(\n    `Transacted Price ($)` = as.numeric(gsub(\",\", \"\", `Transacted Price ($)`)),\n    `Area (SQFT)` = as.numeric(`Area (SQFT)`),\n    `Unit Price ($ PSF)` = as.numeric(gsub(\",\", \"\", `Unit Price ($ PSF)`)),\n    `Sale Date` = dmy(`Sale Date`),\n    `Area (SQM)` = as.numeric(`Area (SQM)`),\n    `Unit Price ($ PSM)` = as.numeric(gsub(\",\", \"\", `Unit Price ($ PSM)`)),\n    `Nett Price($)` = ifelse(is.na(`Nett Price($)`),\n                             `Area (SQM)` * `Unit Price ($ PSM)`,\n                             as.numeric(gsub(\",\", \"\", `Nett Price($)`)))\n  )\n```\n:::\n\n\n::: {.callout-note collapse=\"false\"}\n### **Code Explanation**\n\n-   **Use of `across`**: The **`across()`** function is applied to check and replace empty or placeholder values across specified columns. It replaces any empty strings or '-' with **`NA`**.\n\n-   **Cleaning and Converting Data**: After the placeholders are handled, the script then cleans up currency and area fields, removing commas and converting them to numeric where necessary.\n\n-   **Conditional Calculation for `Nett Price($)`**: After ensuring all data types are correct and placeholders are handled, it calculates **`Nett Price($)`** where needed.\n:::\n\n# **Market Overview Visualization 1:** Trend of Average Unit Prices by Planning Region\n\n::: panel-tabset\n## Central Region\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- cleaned_data %>%\n  filter(`Planning Region` == \"Central Region\") %>% \n  group_by(Month = floor_date(`Sale Date`, \"month\"), `Type of Sale`, `Property Type`) %>%\n  summarize(Average_Price = mean(`Unit Price ($ PSM)`, na.rm = TRUE), .groups = 'drop') %>%\n  ggplot(aes(x = Month, y = Average_Price, color = `Type of Sale`)) +\n  geom_line() +\n  scale_x_date(date_breaks = \"3 month\", date_labels = \"%b %Y\") +\n  labs(\n    title = \"Central Region: Trend of Average Unit Prices Over Time\",\n    x = \"Month\",\n    y = \"Average Unit Price ($ PSM)\"\n  ) +\n  facet_wrap(~ `Property Type`, scales = \"free_y\", strip.position = \"bottom\") +  \n  theme(\n    plot.title = element_text(size = rel(1.5)),\n    legend.position = \"top\",\n    legend.text = element_text(size = rel(0.8)),\n    panel.grid.major = element_line(color = \"grey80\"),\n    panel.grid.minor = element_blank(),\n    plot.margin = margin(10, 10, 10, 10),\n    strip.text = element_text(size = rel(0.8)),  # adjust strip text size\n    axis.text.x = element_text(size = rel(0.8), angle = 45, hjust = 1, vjust = 1),  # adjust x-axis text size\n    axis.ticks.length = unit(-3, \"pt\"),  #aAdjust tick length\n    panel.spacing = unit(1, \"lines\")  # adjust spacing between facets\n  )\n\np1\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nIn the Central Region, Q1 2024 presents a stable pricing pattern for apartments, condominiums, and terrace houses, mirroring trends from the previous year. Conversely, detached houses experienced a significant rise in prices, followed by a pronounced dip, particularly within the sub-sale segment, which has now narrowed down to only resale transactions. It shows there was flutuation under Executive condominiums from March to December 2023, culminating in a complete absence of new sales in the subsequent quarter. Meanwhile, semi-detached houses witnessed a singular decline in June 2023, after which prices entered a gradual and steady climb, indicating a stabilizing market as progress through 2024.\n\n## East Region\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- cleaned_data %>%\n  filter(`Planning Region` == \"East Region\") %>% \n  group_by(Month = floor_date(`Sale Date`, \"month\"), `Type of Sale`, `Property Type`) %>%\n  summarize(Average_Price = mean(`Unit Price ($ PSM)`, na.rm = TRUE), .groups = 'drop') %>%\n  ggplot(aes(x = Month, y = Average_Price, color = `Type of Sale`)) +\n  geom_line() +\n  scale_x_date(date_breaks = \"3 month\", date_labels = \"%b %Y\") +\n  labs(\n    title = \"East Region:Trend of Average Unit Prices Over Time\",\n    x = \"Month\",\n    y = \"Average Unit Price ($ PSM)\"\n  ) +\n  facet_wrap(~ `Property Type`, scales = \"free_y\", strip.position = \"bottom\") +  \n  theme(\n    plot.title = element_text(size = rel(1.5)),\n    legend.position = \"top\",\n    legend.text = element_text(size = rel(0.8)),\n    panel.grid.major = element_line(color = \"grey80\"),\n    panel.grid.minor = element_blank(),\n    plot.margin = margin(10, 10, 10, 10),\n    strip.text = element_text(size = rel(0.8)),  \n    axis.text.x = element_text(size = rel(0.8), angle = 45, hjust = 1, vjust = 1),  \n    axis.ticks.length = unit(-3, \"pt\"),  \n    panel.spacing = unit(1, \"lines\")  \n  )\n\np2\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nIn East Region, Apartments, condominiums and terrace houses have shown relative price stability, with condominiums displaying a slight uprend. Detached houses have seen erratic price movements with a sharp rise followed by a decline in sub-sale prices. Executive condominiums display notable price swings throughout the year, overall, it still demonstrates an upward price trend. In contrast, semi-detached houses show a significant dip year-end but recover to a gentle upward trend.\n\n## North East Region\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- cleaned_data %>%\n  filter(`Planning Region` == \"North East Region\") %>% \n  group_by(Month = floor_date(`Sale Date`, \"month\"), `Type of Sale`, `Property Type`) %>%\n  summarize(Average_Price = mean(`Unit Price ($ PSM)`, na.rm = TRUE), .groups = 'drop') %>%\n  ggplot(aes(x = Month, y = Average_Price, color = `Type of Sale`)) +\n  geom_line() +\n  scale_x_date(date_breaks = \"3 month\", date_labels = \"%b %Y\") +\n  labs(\n    title = \"North East Region: Trend of Average Unit Prices\",\n    x = \"Month\",\n    y = \"Average Unit Price ($ PSM)\"\n  ) +\n  facet_wrap(~ `Property Type`, scales = \"free_y\", strip.position = \"bottom\") +  \n  theme(\n    plot.title = element_text(size = rel(1.5)),\n    legend.position = \"top\",\n    legend.text = element_text(size = rel(0.8)),\n    panel.grid.major = element_line(color = \"grey80\"),\n    panel.grid.minor = element_blank(),\n    plot.margin = margin(10, 10, 10, 10),\n    strip.text = element_text(size = rel(0.8)),  \n    axis.text.x = element_text(size = rel(0.8), angle = 45, hjust = 1, vjust = 1),  \n    axis.ticks.length = unit(-3, \"pt\"), \n    panel.spacing = unit(1, \"lines\")  \n  )\n\np3\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nIn the North East region, the fluctuation in the prices of detached houses is quite pronounced. Additionally, there's a notable upward trend in the prices of executive condominiums, especially within the new sales category.\n\n## North Region\n\n\n::: {.cell}\n\n```{.r .cell-code}\np4 <- cleaned_data %>%\n  filter(`Planning Region` == \"North Region\") %>% \n  group_by(Month = floor_date(`Sale Date`, \"month\"), `Type of Sale`, `Property Type`) %>%\n  summarize(Average_Price = mean(`Unit Price ($ PSM)`, na.rm = TRUE), .groups = 'drop') %>%\n  ggplot(aes(x = Month, y = Average_Price, color = `Type of Sale`)) +\n  geom_line() +\n  scale_x_date(date_breaks = \"3 month\", date_labels = \"%b %Y\") +\n  labs(\n    title = \"North Region:Trend of Average Unit Prices Over Time\",\n    x = \"Month\",\n    y = \"Average Unit Price ($ PSM)\"\n  ) +\n  facet_wrap(~ `Property Type`, scales = \"free_y\", strip.position = \"bottom\") +  \n  theme(\n    plot.title = element_text(size = rel(1.5)),\n    legend.position = \"top\",\n    legend.text = element_text(size = rel(0.8)),\n    panel.grid.major = element_line(color = \"grey80\"),\n    panel.grid.minor = element_blank(),\n    plot.margin = margin(10, 10, 10, 10),\n    strip.text = element_text(size = rel(0.8)),  \n    axis.text.x = element_text(size = rel(0.8), angle = 45, hjust = 1, vjust = 1), \n    axis.ticks.length = unit(-3, \"pt\"),  \n    panel.spacing = unit(1, \"lines\")  \n  )\n\np4\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nIn the North Region, apart from condominiums, other property types display considerable instability. However, as of March 2024, apartments, executive condominiums, and terrace houses continue to exhibit an increasing price trend.\n\n## West Region\n\n\n::: {.cell}\n\n```{.r .cell-code}\np5 <- cleaned_data %>%\n  filter(`Planning Region` == \"West Region\") %>% \n  group_by(Month = floor_date(`Sale Date`, \"month\"), `Type of Sale`, `Property Type`) %>%\n  summarize(Average_Price = mean(`Unit Price ($ PSM)`, na.rm = TRUE), .groups = 'drop') %>%\n  ggplot(aes(x = Month, y = Average_Price, color = `Type of Sale`)) +\n  geom_line() +\n  scale_x_date(date_breaks = \"3 month\", date_labels = \"%b %Y\") +\n  labs(\n    title = \"West Region:Trend of Average Unit Prices Over Time\",\n    x = \"Month\",\n    y = \"Average Unit Price ($ PSM)\"\n  ) +\n  facet_wrap(~ `Property Type`, scales = \"free_y\", strip.position = \"bottom\") +  \n  theme(\n    plot.title = element_text(size = rel(1.5)),\n    legend.position = \"top\",\n    legend.text = element_text(size = rel(0.8)),\n    panel.grid.major = element_line(color = \"grey80\"),\n    panel.grid.minor = element_blank(),\n    plot.margin = margin(10, 10, 10, 10),\n    strip.text = element_text(size = rel(0.8)),  \n    axis.text.x = element_text(size = rel(0.8), angle = 45, hjust = 1, vjust = 1), \n    axis.ticks.length = unit(-3, \"pt\"), \n    panel.spacing = unit(1, \"lines\")  \n  )\n\np5\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nIn the West Region, December 2023 marked a notable uptick in the prices of new sale apartments, surging from approximately \\$19,000 PSM to \\$26,000 PSM, before settling back at \\$22,000 PSM. Conversely, detached and semi-detached houses demonstrated a downward pricing trend.\n:::\n\nIn summary, the Central Region commands the highest unit prices across the board, while the North Region is distinguished by the lowest. Typically, new sales achieve higher prices than sub-sales and resales. However, an exception is noted in the North East Region, where terrace houses experience the lowest prices in sub-sales. Furthermore, the North East and North Regions are both exhibiting an upward price trend as we progress through Q1 of 2024.\n\n# **Market Overview Visualization 2:** Popularity by Type of Sale\n\n::: panel-tabset\n## Popularity Overview by Type of Sale\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# number of transactions by type of sale\ntransactions_by_sale_type <- cleaned_data %>%\n  count(`Type of Sale`) %>%\n  mutate(Percentage = n / sum(n) * 100, \n         Label = paste(`Type of Sale`, round(Percentage, 1), \"%\"))  # set label for each slice\n\n# Custom colors for the pie slices\nslice_colors <- c(\"New Sale\" = \"darkseagreen\", \"Resale\" = \"lavender\", \"Sub Sale\" = \"pink\")\n\n# Create the pie chart\npie_chart <- ggplot(transactions_by_sale_type, aes(x = \"\", y = Percentage, fill = `Type of Sale`)) +\n  geom_col(width = 1) +  # this is to create a bar for each slice with a width that ensures no gaps\n  coord_polar(theta = \"y\") + \n  scale_fill_manual(values = slice_colors) +  \n  geom_text(aes(label = Label), position = position_stack(vjust = 0.5)) +  # add labels of each slice\n  labs(\n    title = \"Popularity Overview by Type of Sale\",\n    x = NULL,\n    y = NULL,\n    fill = \"Type of Sale\"\n  ) +\n  theme_void() +  \n  theme(\n    legend.position = \"bottom\",  # legend postion\n    plot.title = element_text(hjust = 0.5)  # plot title position\n  )\n\npie_chart\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## New Sale\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for 'New Sale' transactions\nnew_sale_transactions <- cleaned_data %>%\n  filter(`Type of Sale` == \"New Sale\") %>%\n  count(`Property Type`, `Planning Region`) %>%\n  complete(`Property Type`, `Planning Region`, fill = list(n = 0))  \n\n# heatmap for 'New Sale'\nheatmap_new_sale <- ggplot(new_sale_transactions, aes(x = `Planning Region`, y = `Property Type`, fill = n)) +\n  geom_tile(color = \"white\") +  \n  geom_text(aes(label = n), color = \"black\", size = 3, vjust = 1) +  \n  scale_fill_gradient(low = \"white\", high = \"darkseagreen\", name = \"Transactions\") + \n  labs(\n    title = \"Popularity of New Sale Flats by Planning Region\",\n    x = \"Planning Region\",\n    y = \"Type of Property\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for better readability\n    legend.position = \"right\"  # legend position\n  )\n\nheatmap_new_sale\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Resale\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for 'Resale' transactions\nnew_sale_transactions <- cleaned_data %>%\n  filter(`Type of Sale` == \"Resale\") %>%\n  count(`Property Type`, `Planning Region`) %>%\n  complete(`Property Type`, `Planning Region`, fill = list(n = 0))  \n\n# Create the heatmap for 'Resale'\nheatmap_Resale <- ggplot(new_sale_transactions, aes(x = `Planning Region`, y = `Property Type`, fill = n)) +\n  geom_tile(color = \"white\") +  \n  geom_text(aes(label = n), color = \"black\", size = 3, vjust = 1) +  \n  scale_fill_gradient(low = \"white\", high = \"lavender\", name = \"Transactions\") +  \n  labs(\n    title = \"Popularity of Resale Flats by Planning Region\",\n    x = \"Planning Region\",\n    y = \"Type of Property\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),  \n    legend.position = \"right\"  \n  )\n\nheatmap_Resale\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## Sub Sale\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for 'Sub Sale' transactions\nnew_sale_transactions <- cleaned_data %>%\n  filter(`Type of Sale` == \"Sub Sale\") %>%\n  count(`Property Type`, `Planning Region`) %>%\n  complete(`Property Type`, `Planning Region`, fill = list(n = 0)) \n\n# Create the heatmap for 'Sub Sale'\nheatmap_Sub_Sale <- ggplot(new_sale_transactions, aes(x = `Planning Region`, y = `Property Type`, fill = n)) +\n  geom_tile(color = \"white\") +  \n  geom_text(aes(label = n), color = \"black\", size = 3, vjust = 1) + \n  scale_fill_gradient(low = \"white\", high = \"pink\", name = \"Transactions\") +  \n  labs(\n    title = \"Popularity of Sub-sale Flats by Planning Region\",\n    x = \"Planning Region\",\n    y = \"Type of Property\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1),  \n    legend.position = \"right\"  \n  )\n\nheatmap_Sub_Sale\n```\n\n::: {.cell-output-display}\n![](takehome1_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n:::\n\nMoving forward, we will explore transaction volumes to gauge popularity. Resale properties dominate the market, accounting for 62% of transactions, followed by new sales at 32.2% and sub-sales at 5.8%. Under both resale and new sale categories, condominiums and apartments in the Central Region are the most favored, while the North Region remains the least preferred. Interestingly, resale transactions show a preference for condominiums, whereas buyers of new sales are inclined towards apartments. In the case of sub-sales, the North East Region emerges as the most popular, with the Central Region trailing behind, yet the North Region consistently ranks as the least favored across all sales types.\n",
    "supporting": [
      "takehome1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}